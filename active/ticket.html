<!DOCTYPE html>
<!-- saved from url=(0033)http://jfx.jssdw.com/prize/manage -->
<html lang="zh-cn">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
		<!-- 测试时使用，阻止浏览器缓存-->
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="Cache-Control" content="no-cache">
		<meta http-equiv="Pragma" content="no-cache">
		<meta name="description" content="">
		<meta name="keywords" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>兑奖管理</title>
		<link href="./favicon.ico" type="image/x-icon" rel="icon">
		<link href="./favicon.ico" type="image/x-icon" rel="shortcut icon">
		<link href="./statics/css/style.css" rel="stylesheet">
		<script src="./statics/plug-in/jquery-1.8.2.min.js"></script>
		<script src="./statics/plug-in/store+json2.min.js"></script>
		<script src="./statics/js/master.js"></script>

		<style type="text/css">
			.send {
				position: relative;
				width: 150px;
				height: 35px;
				line-height: 35px;
				text-align: center;
				color: white;
				background: #F8C301;
				-moz-border-radius: 5px;
				-webkit-border-radius: 5px;
				border-radius: 5px;
				/* 圆角 */
				
				margin-left: 10px;
				margin-top: 10px;
			}
			.send .arrow {
				position: absolute;
				top: -16px;
				left: 20px;
				/* 圆角的位置需要细心调试哦 */
				
				width: 0;
				height: 0;
				font-size: 0;
				border: solid 8px;
				border-color: transparent transparent #F8C301 transparent;
			}
		</style>
	</head>

	<body>
		<div class="frame_header">
			<div class="h41 w1000 bc clearfix">
				<div class="fl">
					<a href="#">
						<img alt="logo" src="./statics/images/system/logo.gif" />
					</a>
				</div>
				<div class="icons fr">
					<a class="icon1" href="/User/Info" id="name1" title=''></a>
					<a class="icon3 ml20" href="javascript:void(0);" id="quit">退出</a>
				</div>
			</div>
			<div class="h68 w1000 bc clearfix">
				<div class="left_menu">
					<a id="menu_Sys" href="/active/system.html" class="menu_1">系统概述</a>
	                <a id="menu_Activity" href="/active/activity.html" class="menu_2 ml10">活动管理</a>
	                <a id="menu_Prize" href="/active/ticket.html" class="menu_3 ml10">兑奖管理</a>
				</div>
				<div class="right_menu clearfix">
					<input id="menu_activities" class="activities" type="button" onclick="master.addact()" />
					<input id="menu_prize" class="prize ml5" type="button" onclick="location.href = '/active/prize.html'" />
					<div id="addwaring" style="position:absolute; margin-top:3px;display:none;z-index:99;">
						<img src="./statics/images/system/addwarning.png" alt="" />
					</div>


				</div>
			</div>
		</div>
		<div>

			<link href="./statics/css/Common_backup.css" rel="stylesheet">
			<link href="./statics/css/jquery-ui-1.10.3.custom.css" rel="stylesheet">
			<link href="./statics/css/Main.css" rel="stylesheet">
			
			<div class="frame_cont bc clearfix">
				<div class="filter  mt15">
					<div class="clearfix mt15">
						<div class="fl f_w_t">首次兑奖时间：</div>
						<input class="fl time_select" type="text" id="datePicker" readonly="readonly" />
						<!--日历-->
						<div class="fc_area_sub" id="filterDateSwitch" style="z-index: 10000;">
							<div class="fc_area_sub_shadow time_shadow">
							</div>
							<div class="fc_area_sub_shadow2 time_shadow2">
							</div>
							<div class="clear">
							</div>
							<!-- 日历控件结构-->
							<div class="calendar-box">
								<div class="calendarbox">
									<table>
										<tr>
											<td class="date_pic_colum" style="vertical-align: top;">
												<table class="ds-wrap ds-table1">
													<tbody>
														<tr>
															<td valign="top" class="ds-prev">
																<div style="" sign="prevyear" class="ds-prevyear"></div>
																<div style="" sign="prevmonth" class="ds-prevmonth"></div>
															</td>
															<td class="ds-cal-blank"></td>
															<td valign="top" class="calendarWrap1 ds-cal-wrap"></td>
															<td class="ds-cal-blank"></td>
															<td valign="top" class="calendarWrap2 ds-cal-wrap"></td>
															<td valign="top" class="ds-next">
																<div style="" sign="nextyear" class="ds-nextyear"></div>
																<div style="" sign="nextmonth" class="ds-nextmonth"></div>
															</td>
														</tr>
													</tbody>
												</table>
											</td>
											<td class="date_pic_colum" style="vertical-align: top;">
												<table class="ds-wrap ds-table2">
													<tbody>
														<tr>
															<td valign="top" class="ds-prev">
																<div style="" sign="prevyear" class="ds-prevyear"></div>
																<div style="" sign="prevmonth" class="ds-prevmonth"></div>
															</td>
															<td class="ds-cal-blank"></td>
															<td valign="top" class="calendarWrap1 ds-cal-wrap"></td>
															<td class="ds-cal-blank"></td>
															<td valign="top" class="calendarWrap2 ds-cal-wrap"></td>
															<td valign="top" class="ds-next">
																<div style="" sign="nextyear" class="ds-nextyear"></div>
																<div style="" sign="nextmonth" class="ds-nextmonth"></div>
															</td>
														</tr>
													</tbody>
												</table>
											</td>
										</tr>
									</table>
								</div>
								<div class="date-select-tip"></div>
								<div class="btn-bar" style="text-align: right;">
									<input type="button" class="yes_btn fc_btn" value="确定" />&nbsp;&nbsp;&nbsp;
									<input type="button" class="cancel_btn fc_btn" value="取消" />
								</div>
							</div>
							<!-- 日历控件结构 -->
						</div>
					</div>
					<div class="clearfix mt5 mb15">
						<div class="fl f_w_t">会员所在地区：</div>
						<div class="fl w545 clearfix">
							<div class="fl tf_select w85" id="mdivProvince">
								<input type="text" value="全部" class="select_txt w55" id="mtxtProvince" readonly="readonly">
								<ol id="molProvince" class="js-countrylist w102">
									<li value="全部">全部</li>
								</ol>
							</div>
							<div class="fl tf_select w85" id="mdivCity">
								<input type="text" value="全部" class="select_txt w55" id="mtxtCity" readonly="readonly">
								<ol id="molCity" class="js-countrylist w102">
								</ol>
							</div>

							<input class="saixuan_btn" type="button" id="saixun" />
							<div class="sum">
								会员人数：<span>4</span>
							</div>
						</div>
					</div>
				</div>
				<table class="filter_data mt10" id="js-table">
					<thead>
						<tr class="filter_data_th">
							<th style="width: 65px; border-left: 1px solid #00a3e7">序号</th>
							<th style="width: 85px">首次兑奖时间</th>
							<th style="width: 100px">姓名</th>
							<th style="width: 120px">参与活动数</th>
							<th style="width: 80px">获奖数</th>
							<th style="width: 100px">兑奖数</th>
							<th style="width: 300px">最后一次参与的活动</th>
							<th style="width: 150px; border-right: 1px solid #00a3e7">操作</th>
						</tr>
					</thead>
					<tbody>
						
					</tbody>
				</table>
				<div id="pagination" class="pagination" style="display:none;">
				</div>
				<div id="showdetails1"></div>
			</div>
			
			<script src="./statics/plug-in/jquery.pagination.js"></script>
			<script src="./statics/plug-in/jquery-ui-1.8.24.min.js"></script>
			<script src="./statics/plug-in/tj_jquery-Canlendar.js"></script>
			<script src="./statics/plug-in/datepicker.js"></script>
			<script src="./statics/plug-in/json3.min.js"></script>
			<style type="text/css">
				.fc_area_sub {
					background: none repeat scroll 0 0 #d8e1f2;
					border: 1px solid #5c75a9;
					cursor: auto;
					display: none;
					position: absolute;
					right: 37px;
					top: 106px;
					width: 310px;
					z-index: 20;
				}
				.fc_area_sub {
					right: 516px;
					top: 44px;
				}
				#filterDateSwitch,
				.w_366 {
					width: 366px;
				}
			</style>
			<script src="./statics/js/subpage.js"></script>
			<script>

				var djgl = {
			        init: function () {
			        	var htmlDiv = "";  
			            $.ajax({
			                url: "/merchant/promotion_list",
			                type: "get",
			                dataType: "json",
			                success: function(data) {
			                    var list = data.list;
			                    for (var i = 0; i < list.length; i++) {
			                    	$.ajax({
						                url: "/merchant/prize_list?promotion_id="+list[i].id,
						                type: "get",
						                dataType: "json",
						                success: function(A) {
						                    var A_list = A.list;
						                    for (var j = 0; j < A_list.length; j++) {
						                    	var done_datetime = formatCSTDate(A_list[j].done_datetime,"yyyy.MM.dd")
												htmlDiv += 
							                    	'<tr>'+
														'<td class="border_l">1</td>'+
														'<td>'+done_datetime+'</td>'+
														'<td>'+A_list[j].user_id+'</td>'+
														'<td>'+A_list[j].user_id+'</td>'+
														'<td>'+A_list[j].user_id+'</td>'+
														'<td>'+A_list[j].user_id+'</td>'+
														'<td>'+A_list[j].user_id+'</td>'+
														'<td class="border_r"><a class="check_detail">会员详细</a>'+
														'</td>'+
													'</tr>'+
													'<tr class="w_border">'+
														'<td colspan="8" class="clearfix border_l clearfix border_r">'+
															'<span class="fl ml_1">地区：</span>'+
															'<span class="fl ml_2" title="--">地址：--</span>'+
														'</td>'+
													'</tr>';

						                    };
						                    
											$("#js-table tbody").html(htmlDiv);   //HTML拼接赋值

						                }
						            });



			                    };
			                }
			            });
			        }
			    };
			    djgl.init();




				$(function() {
					//初始化弹框
					$("#showdetails1").dialog({
						autoOpen: false, //关闭自动打开
						width: 600, //设置宽度
						height: 400, //设置高度
						title: "会员详细", //设置标题
						dialogClass: 'pop_container', //设置样式
						close: function(ev, ui) //关闭事件
							{
								addmorecount = 0; //设置更多为0
								$("#showdetails1").empty(); //清空弹框内容
							}
					});
					var now_year = '2014'; //获取年
					var now_month = '12'; //获取月
					var now_day = '4'; //获取天
					//获取现在时间
					var now_date = new Date(now_year, now_month - 1, now_day);
					//开始时间
					var data_begin = "{\"year\":" + now_year + ",\"month\":" + now_month + ",\"day\":" + now_day + "}";
					//结束时间
					var data_end = "{\"year\":" + (now_year - 1) + ",\"month\":" + now_month + ",\"day\":" + now_day + "}";
					//json转数组
					data_begin = jQuery.parseJSON(data_begin);
					//json转数组
					data_end = jQuery.parseJSON(data_end);
					//实例化时间
					var now = new Date();
					//开始时间
					var data_begin = data_begin;
					//结束时间
					var data_end = data_end;
					//相同的天
					theSameDay = 100;
					//地区数组
					var ArrArea = [{
						Province: "全部",
						City: ""
					}];
					var txtDate = "全部";
					$("#datePicker").attr("data-begin", '2014/1/1'); //设置日期开始 
					$("#datePicker").attr("data-end", now_year + '/' + now_month + '/' + now_day); //设置结束时间
					$('#datePicker').ShowCalendar({
						reg_year: now.getFullYear(),
						reg_month: 1,
						reg_date: 1,
						date_range_begin: data_begin,
						date_range_end: data_end,
						ifrange_same: theSameDay,
						callback: function(start, end) {
							if (end == null) {
								end = start;
							}
							if (end == '') {
								end = start;
								//选择多日期时隐藏
								$("#filterDateSwitch").hide();
							} else {
								//选择多日期时隐藏
								$("#filterDateSwitch").hide();
							}
						}
					});
					$('#datePicker').bind('click', function() {
						$('#filterDateSwitch').show(); //显示日期控件
					});
					$("#filterDateSwitch .cancel_btn").click(function() {
						$("#filterDateSwitch").hide(); //隐藏日期控件
					});
					//取消日期框，和日期文本框的事件冒泡。使其不隐藏。与下面配合使用
					$(".calendar-box,#datePicker").click(function(event) {
						event.stopPropagation();
					});
					//点击页面任何部分都隐藏日历
					$(document).click(function(e) {
						$("#filterDateSwitch").hide();
					});

					//获取参数省
					var prov = getParameterByName("province");
					//获取参数市
					var city = getParameterByName("city");
					if (prov != "") {
						$("#mtxtProvince").val(prov); //省
					}
					if (city != "") {
						$("#mtxtCity").val(city); //市
					}
					//获取开始时间
					var startd = getParameterByName("start");
					//获取结束时间
					var endd = getParameterByName("end");
					if ((startd == "" && endd == "") || (startd == "1/1/1753 12:00:00 AM" && endd == "1/1/1753 12:00:00 AM")) {
						$("#datePicker").val(); //日期
					} else if (startd == endd) {
						$("#datePicker").val($.trim(startd)); //日期
					} else {
						$("#datePicker").val($.trim(startd) + " 至 " + $.trim(endd)); //日期
					}


					//下拉框省
					$("#mdivProvince").click(function() {
						var ol = $(this).children("ol"); //显示下拉框
						//显示省
						ol.toggle();

						var pli = $("#molProvince li");
						if (pli.length > 4) {
							$("#molProvince").css("overflow-y", "scroll");
						} else {
							$("#molProvince").css("overflow-y", "auto");
						}

						//绑定点击事件
						$("#molProvince li").click(function() {
							$("#mtxtProvince").val($(this).text()); //赋值
							$("#molCity").empty(); //清空市
							$("#mtxtCity").val("全部"); //清空市
						});
					});
					//下拉框市
					$("#mdivCity").click(function() {


						$(this).children('ol').toggle(); //显示下拉框
						$("#molCity").empty(); //清空市
						//$("#mtxtCity").val("全部");//清空市
						//循环地区
						for (var i = 0; i < ArrArea.length; i++) {
							//判断省相等获取对应的市
							if (ArrArea[i].Province == $("#mtxtProvince").val() && $("#mtxtProvince").val() != "全部") {
								//追加option
								$("#molCity").append("<li value=\"" + ArrArea[i].City + "\">" + ArrArea[i].City + "</li>");
							}
						}
						//追加option
						$("#molCity").prepend("<li value=\"\" selected=\"true\">全部</li>");

						var cli = $("#molCity li");
						if (cli.length > 4) {
							$("#molCity").css("overflow-y", "scroll");
						} else {
							$("#molCity").css("overflow-y", "auto");
						}


						//市下的li绑定点击事件
						$("#molCity li").click(function() {
							$("#mtxtCity").val($(this).text()); //获取值赋给文本框
						});
					});
					//点击其他地方时把ol下拉框隐藏
					$(document).mousedown(function(e) {
						var clickObj = (e.target || e.srcElement); //获取点击对象
						//判断是否在ol下拉框和input上如果不是隐藏
						if ($(clickObj).attr("id") != "mtxtProvince" //判断
							&& $(clickObj).attr("id") != "mdivProvince" //判断
							&& $(clickObj).attr("id") != "molProvince" //判断
							&& $(clickObj).parent().attr("id") != "molProvince") {
							$("#molProvince").hide(); //隐藏省
						}
						if ($(clickObj).attr("id") != "molCity" //判断
							&& $(clickObj).attr("id") != "mdivCity" //判断
							&& $(clickObj).attr("id") != "mtxtCity" //判断
							&& $(clickObj).parent().attr("id") != "molCity") {
							$("#molCity").hide(); //隐藏市
						}
					});
					var leftMenu = $(".left_menu a"); //获取菜单
					leftMenu[0].className = "menu_1"; //设置class
					leftMenu[1].className = "menu_2  ml10"; //设置class
					leftMenu[2].className = "menu_3 ml10 cur_3"; //设置class
					//分页
					$("#pagination").pagination(4, {
						callback: PageCallback, //回调方法
						prev_text: '上一页', //上一页按钮里text
						next_text: '下一页', //下一页按钮里text
						items_per_page: 20, //显示条数
						num_display_entries: 6, //连续分页主体部分分页条目数
						current_page: 0, //当前页索引
						num_edge_entries: 1, //两侧首尾分页条目数
						prev_show_always: false,
						next_show_always: false
					});
					//添加筛选点击事件
					$("#saixun").click(function() {
						var start = "1/1/1753 12:00:00 AM"; //开始时间默认值
						var end = "1/1/1753 12:00:00 AM"; //结束时间默认值
						var date = $("#datePicker").val(); //获取时间
						//判断时间是否是时间段
						if (date.indexOf("至") > -1) {
							var sdate = date.split("至"); //处理时间
							start = sdate[0]; //获取开始时间
							end = sdate[1]; //获取结束时间
						} else if (date != "") {
							//判断是否是单时间
							start = date; //设置开始时间
							end = date; //设置结束时间
						}
						//获取选择的省
						var province = $("#mtxtProvince").val();
						//获取选择的市
						var city = $("#mtxtCity").val();
						//判断省
						if (province == "全部") {
							province = ""; //赋空值
						}
						//判断市
						if (city == "全部") {
							city = ""; //赋空值
						}
						//跳转
						window.location = "/Prize/Manage?start=" + $.trim(start.toLocaleString()) + "&end=" + $.trim(end.toLocaleString()) + "&province=" + province + "&city=" + city + "&pageindex=0";
					});
				});
				 //翻页调用
				function PageCallback(index) {
						var url = location.search; //获取url中"?"符后的字串
						if (url == "") {
							//跳转
							window.location = "/Prize/Manage?pageindex=" + index;
						}
						//跳转
						window.location = changeQuery(window.location.toString(), "pageindex", index);
					}
					//改变url参数值

				function changeQuery(url, name, value) {
						var reg = new RegExp("(^|)" + name + "=([^&]*)(|$)");
						var tmp = name + "=" + value;
						if (url.match(reg) != null) {
							return url.replace(eval(reg), tmp);
						} else {
							if (url.match("[\?]")) {
								return url + "&" + tmp;
							} else {
								return url + "?" + tmp;
							}
						}
					}
					//显示详情

				function showinfo(id) {
						var nowDate = new Date();
						//加载显示详情html
						$("#showdetails1").load("/Prize/ShowInfo?id=" + id + "&date=" + ((new Date()).valueOf()) + "", function() {
							//打开对话框
							$("#showdetails1").dialog("open");
						});
					}
					//获取url参数值

				function getParameterByName(name) {
					name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
					var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
						results = regex.exec(location.search);
					return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
				}
			</script>

		</div>
		<div class="login_ft">

			苏ICP备08010158号


		</div>
	</body>

</html>